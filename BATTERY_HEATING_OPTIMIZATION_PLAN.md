# 배터리 소모 및 발열 문제 최적화 계획

## 현재 상태 분석 요약

### ✅ 이미 최적화된 부분
1. **프리뷰 해상도**: 720p 이하로 제한 (라인 354-391)
2. **프리뷰 샘플링**: 2프레임마다 1번 필터 적용 (기본값)
3. **얼굴 인식 샘플링**: 10프레임마다 1번
4. **Metal 렌더링**: GPU 가속 사용
5. **중복 렌더링 방지**: `hasNewImage` 플래그 사용
6. **프리뷰 FPS**: 24fps로 제한

### ⚠️ 최적화 필요 부분
1. **필터 적용 빈도**: 2프레임마다 1번 = 약 15fps로 필터 적용 (너무 빈번)
2. **setState 과다 호출**: 카메라 상태 변경마다 전체 위젯 트리 재빌드
3. **프레임/칩 오버레이**: 불필요하게 재그리기
4. **필터 변경 감지**: 필터가 변경되지 않아도 계속 적용

## 최적화 방안

### 1. 필터 적용 최적화

**현재 문제:**
- 필터가 변경되지 않아도 2프레임마다 1번 필터 적용
- 필터 변경 시에만 필터를 적용하도록 변경

**해결 방안:**
- 필터 변경 시에만 필터 적용
- 또는 필터 미리보기는 더 낮은 주기(예: 500ms)로만 업데이트

### 2. setState 최소화

**현재 문제:**
- `_cameraEngine.addListener(() { setState({}); })` - 전체 재빌드
- 필터 변경 시 전체 재빌드
- 밝기 변경 시 전체 재빌드

**해결 방안:**
- ValueNotifier 기반 세분화된 상태 관리
- RepaintBoundary로 프레임/칩 오버레이 분리
- const 위젯 최대한 활용

### 3. 프레임/칩 오버레이 최적화

**현재 문제:**
- 카메라 상태 변경마다 전체 위젯 재빌드
- 프레임/칩 데이터가 변경되지 않아도 재그리기

**해결 방안:**
- 데이터 변경 시에만 repaint
- RepaintBoundary로 분리

